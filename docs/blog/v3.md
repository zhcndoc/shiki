---
outline: deep
---

# Shiki v3.0.0

Shiki v3.0.0 æ˜¯ [å¦ä¸€ä¸ª](./v2) **æ— èŠ** çš„ç‰ˆæœ¬ï¼Œç§»é™¤äº†è‡ª v1.x å¼€å§‹æ ‡è®°å¹¶åœ¨ v2.x ä¸­æ˜ç¡®è­¦å‘Šçš„å¼ƒç”¨ APIã€‚

åœ¨ Shiki ä¸­ï¼Œæ–°åŠŸèƒ½åœ¨æ¬¡è¦ç‰ˆæœ¬ä¸­é€æ­¥å‘å¸ƒï¼Œè€Œä¸»è¦ç‰ˆæœ¬åˆ™ç”¨äºæ¸…ç†å’Œç§»é™¤å¼ƒç”¨çš„ APIã€‚

å¦‚æœæ‚¨ä»åœ¨ä½¿ç”¨ v1.xï¼Œè¯·å…ˆ [è¿ç§»åˆ° v2.x](./v2)ã€‚è¿™åº”è¯¥ä¸ºæ‚¨æä¾›é¡ºåˆ©è¿‡æ¸¡åˆ° v3.0.0 çš„è·¯å¾„ã€‚

## ç ´åæ€§å˜æ›´

- `v1.x`ï¼šå¼ƒç”¨çš„ API ä»ç„¶å—æ”¯æŒï¼Œä»…åœ¨ç±»å‹çº§åˆ«ä¸Šæ ‡è®°ã€‚å¯é€‰çš„è¿è¡Œæ—¶è­¦å‘Šä»¥é€‰æ‹©åŠ å…¥ã€‚
- `v2.0`ï¼šæ²¡æœ‰ç ´åæ€§å˜æ›´ï¼Œä½†é»˜è®¤å¯ç”¨è¿è¡Œæ—¶å¼ƒç”¨è­¦å‘Šã€‚
- ğŸ‘‰ `v3.0`ï¼šç§»é™¤å¼ƒç”¨çš„ APIï¼Œç ´åæ€§å˜æ›´ã€‚

### `getHighlighter` -> `createHighlighter`

æ²¡æœ‰åŠŸèƒ½ä¸Šçš„å˜åŒ–ï¼Œæ›´åƒæ˜¯ä¿®æ­£å‘½åä»¥é¿å…æ··æ·†ã€‚åº”è¯¥æ˜¯ç®€å•çš„æŸ¥æ‰¾å’Œæ›¿æ¢ã€‚

### WASM ç›¸å…³ API

è‡ª v1.16 å¼•å…¥ [å¼•æ“ç³»ç»Ÿ](/guide/regex-engines) åï¼ŒWebAssembly ç›¸å…³ä¾èµ–ä¸å†æ˜¯ç¡¬æ€§è¦æ±‚ã€‚ä¸ºäº†ä¿ƒè¿›æ ‘æ‘‡ï¼ˆtree-shakingï¼‰å¹¶å°†å¼•æ“ä¸æ ¸å¿ƒè§£è€¦ï¼Œæå–äº†ä¸¤ä¸ªåŒ…ï¼š`@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript`ã€‚è¿™ä¸¤ä¸ªåŒ…ä¹Ÿä»ä¸»åŒ…é‡æ–°å¯¼å‡ºä¸º `shiki/engine/oniguruma` å’Œ `shiki/engine/javascript`ã€‚

æ‚¨å¯èƒ½éœ€è¦æ›´æ”¹æ‚¨çš„å¯¼å…¥è·¯å¾„ï¼š

```ts
import { loadWasm } from 'shiki' // [!code --]
import { loadWasm } from 'shiki/engine/oniguruma' // [!code ++]
```

`createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢« `engine` å­—æ®µæ›¿æ¢ï¼š

```ts
import { createHighlighter } from 'shiki'
import { createOnigurumaEngine } from 'shiki/engine/oniguruma' // [!code ++]

const shiki = await createHighlighter({
  // ...
  loadWasm: () => import('shiki/wasm'), // [!code --]
  engine: createOnigurumaEngine(() => import('shiki/wasm')), // [!code ++]
})
```

åŒæ—¶ï¼Œ`@shikijs/core` åŒ…ä¸å†åŒ…å«å¼•æ“æˆ– wasm äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‚¨éœ€è¦ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` åŒ…ä¸­å¯¼å…¥å®ƒä»¬ã€‚

### Shiki å…¼å®¹æ€§

ä¸ºä¸ v0.14 å…¼å®¹è€Œæ„å»ºçš„ `@shikijs/compat` åŒ…ç°åœ¨å·²åœæ­¢ç»´æŠ¤ã€‚è¯·è¿ç§»åˆ°ä¸»åŒ…ã€‚

### è½¬æ¢å™¨åŒ¹é…ç®—æ³•

åœ¨ v1.29.0 ä¸­å¼•å…¥äº†è½¬æ¢å™¨çš„ `matchAlgorithm` é€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©åŒ¹é…ç®—æ³•ã€‚åœ¨ v3.0.0 ä¸­ï¼Œé»˜è®¤å€¼ä» `v1` æ›´æ”¹ä¸º `v3`ã€‚

[äº†è§£æ›´å¤š](/packages/transformers#matching-algorithm)ã€‚

### å…¶ä»–ç ´åæ€§å˜æ›´

- `createdBundledHighlighter` éœ€è¦ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡æ ·å¼å‚æ•°
- `@shikijs/core`
  - æ­£åˆ™å¼•æ“ `createJavaScriptRegexEngine` å’Œ `createOnigurumaEngine` ä¸å†åŒ…å«ï¼Œåˆ†åˆ«ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` å¯¼å…¥
  - `@shikijs/core/wasm-inline` è¢« `@shikijs/engine-oniguruma/wasm-inline` æ›¿æ¢
  - ä» `@shikijs/vscode-textmate` å¯¼å…¥ `FontStyle` å’Œ `StackElementMetadata`ï¼Œè€Œä¸æ˜¯ `@shikijs/core`

## ä½œä¸ºç”¨æˆ·å°è¯•

å¦‚æœæ‚¨é€šè¿‡å…¶ä»–åŒ…é—´æ¥ä½¿ç”¨ Shikiï¼Œä¾‹å¦‚ [`vitepress`](https://vitepress.dev/) æˆ– [`@nuxt/content`](https://content.nuxt.com/)ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹æ‚¨æ— æ³•ç›´æ¥æ§åˆ¶ Shiki çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å°è¯•åœ¨ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼Œä»¥å¼ºåˆ¶ä½¿ç”¨ [Shiki v2.0.0](./v2)ã€‚

```json
{
  "resolutions": {
    "shiki": "^2",
    "@shikijs/core": "^2",
    "@shikijs/types": "^2",
    "@shikijs/transformers": "^2",
    "@shikijs/markdown-it": "^2",
    "@shikijs/rehype": "^2"
  }
}
```

ç„¶åè¿è¡Œå·¥å…·æŸ¥çœ‹æ˜¯å¦å‘å‡ºä»»ä½•è­¦å‘Šã€‚å¦‚æœæœ‰ï¼Œè¯·å‘å…¶å¯¹åº”çš„ä»“åº“æŠ¥å‘Šï¼Œä»¥æå‡å¯¹å³å°†å‘ç”Ÿçš„å˜æ›´çš„è®¤è¯†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå·¥å…·åº”èƒ½æŒ‰é¢„æœŸä¸ Shiki v3.0.0 ä¸€èµ·æ­£å¸¸å·¥ä½œï¼Œæ­¤æ—¶æ‚¨å¯ä»¥è¿›ä¸€æ­¥è¿ç§»åˆ° v3ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
  "resolutions": {
    "shiki": "^3",
    "@shikijs/core": "^3",
    "@shikijs/types": "^3",
    "@shikijs/transformers": "^3",
    "@shikijs/markdown-it": "^3",
    "@shikijs/rehype": "^3"
  }
}
```

## åé¦ˆ

æ¬¢è¿ä»»ä½•åé¦ˆï¼éšæ—¶åœ¨ [GitHub](https://github.com/shikijs/shiki) ä¸Šæå‡ºé—®é¢˜ï¼Œè®©æˆ‘ä»¬çŸ¥é“æ‚¨çš„æƒ³æ³•ã€‚
