---
outline: deep
---

# Shiki v2.0.0

Shiki v2.0.0 æœ¬èº«æ˜¯ä¸€ä¸ª **æ— èŠ** çš„ç‰ˆæœ¬ã€‚

å¦‚æœä½ é”™è¿‡äº†ï¼Œåœ¨å°ç‰ˆæœ¬æ›´æ–°ä¸­é™†ç»­æ¨å‡ºäº†ä¸€äº›éå¸¸é…·çš„æ–°åŠŸèƒ½ï¼š

| ç‰ˆæœ¬                                                             | æ–°ç‰¹è‰²åŠŸèƒ½                                                                                                                               |
| ---------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| [v1.1.0](https://github.com/shikijs/shiki/releases/tag/v1.1.0)   | æ›´å¥½çš„ Twoslash æ”¯æŒ                                                                                                                     |
| [v1.3.0](https://github.com/shikijs/shiki/releases/tag/v1.3.0)   | æ–°çš„ `structure: inline` é€‰é¡¹                                                                                                            |
| [v1.6.0](https://github.com/shikijs/shiki/releases/tag/v1.6.0)   | ä½œç”¨åŸŸé¢œè‰²æ›¿æ¢ï¼Œæ„Ÿè°¢ [@QuentinRoy](https://github.com/QuentinRoy)                                                                        |
| [v1.8.0](https://github.com/shikijs/shiki/releases/tag/v1.8.0)   | æš´éœ² `.dispose()` æ–¹æ³•ä»¥è¿›è¡Œæ˜¾å¼çš„èµ„æºæ¸…ç†                                                                                               |
| [v1.10.0](https://github.com/shikijs/shiki/releases/tag/v1.10.0) | å¼•å…¥äº† [Grammar State](/guide/grammar-state) ä»¥æ”¯æŒéƒ¨åˆ†ä»£ç é«˜äº®                                                                          |
| [v1.15.0](https://github.com/shikijs/shiki/releases/tag/v1.15.0) | å¼•å…¥äº† [JavaScript Engine](/guide/regex-engines#javascript-engine)ï¼Œå…·æœ‰æ›´å¥½çš„å¯ç§»æ¤æ€§å’Œæ›´å°çš„åŒ…ä½“ç§¯                                     |
| [v1.16.0](https://github.com/shikijs/shiki/releases/tag/v1.16.0) | æ”¯æŒ [Synchronous Usage](/guide/sync-usage)                                                                                              |
| [v1.19.0](https://github.com/shikijs/shiki/releases/tag/v1.19.0) | å¼•å…¥äº† `enableDeprecationWarnings()` å‡½æ•°ä»¥ä¾¿äºè¿ç§»ã€‚æ”¯æŒå¯¹è±¡æ ·å¼ `htmlStyle` å’Œæ–°çš„ `htmlAttrs` ä¸»é¢˜ä»¤ç‰Œã€‚                              |
| [v1.23.0](https://github.com/shikijs/shiki/releases/tag/v1.23.0) | æ–°å¢äº† [`@shikijs/colorized-brackets`](/packages/colorized-brackets) åŒ…ï¼Œæ„Ÿè°¢ [@MichaelMakesGames](https://github.com/MichaelMakesGames) |
| [v1.24.0](https://github.com/shikijs/shiki/releases/tag/v1.24.0) | æ”¹è¿›äº† JavaScript å¼•æ“çš„æ€§èƒ½å’Œå‡†ç¡®æ€§ï¼Œæ„Ÿè°¢ [@slevithan](https://github.com/slevithan)                                                    |
| [v1.25.0](https://github.com/shikijs/shiki/releases/tag/v1.25.0) | å°†ä¸»é¢˜å’Œè¯­è¨€åˆ†ç¦»åˆ° `@shikijs/themes` å’Œ `@shikijs/languages` åŒ…ä¸­                                                                        |
| [v1.26.0](https://github.com/shikijs/shiki/releases/tag/v1.26.0) | å¼•å…¥äº† [é¢„ç¼–è¯‘è¯­è¨€](https://shiki.style/guide/regex-engines#pre-compiled-languages) åŒ…ï¼Œä»¥å‡å°åŒ…ä½“ç§¯å¹¶æé«˜æ€§èƒ½                           |
| [v1.27.0](https://github.com/shikijs/shiki/releases/tag/v1.27.0) | æ–°å¢äº† [`shiki-codegen`](/packages/codegen) åŒ…ä»¥ä¾¿äºæ›´ç»†ç²’åº¦çš„åŒ…åˆ›å»º                                                                     |
| [v1.29.0](https://github.com/shikijs/shiki/releases/tag/v1.28.0) | æ”¹è¿›äº†è½¬æ¢å™¨åŒ¹é…ç®—æ³•ï¼Œæ¨å‡ºäº† `matchAlgorithm` é€‰é¡¹ã€‚æ„Ÿè°¢ [@fuma-nama](https://github.com/fuma-nama)                                      |

åœ¨æ‰€æœ‰è¿™äº›æ–°åŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬è¿˜åŒ…æ‹¬äº†è®¸å¤šæ–°çš„è¯­è¨€æ”¯æŒå’Œæ–°ä¸»é¢˜ã€‚æŸ¥çœ‹ [languages](/languages) å’Œ [themes](/themes) åˆ—è¡¨ä»¥è·å–å®Œæ•´åˆ—è¡¨ã€‚

åŒæ—¶ï¼Œç‰¹åˆ«æ„Ÿè°¢ [@slevithan](https://github.com/slevithan) åœ¨ [`oniguruma-to-es`](https://github.com/slevithan/oniguruma-to-es) ä¸Šçš„å“è¶Šå·¥ä½œï¼Œä½¿å¾— JavaScript å¼•æ“ [æ”¯æŒ 97.2% çš„æ‰€æœ‰è¯­è¨€](/references/engine-js-compat)ã€‚

## é‡å¤§å˜æ›´

åœ¨ v2.0.0 ä¸­ **æ²¡æœ‰** ç¡¬æ€§é‡å¤§å˜æ›´ã€‚å®ƒæ˜¯å³å°†åˆ°æ¥çš„ v3.0.0 çš„ä¸€ä¸ªå«è„šçŸ³ã€‚

v2 çš„å”¯ä¸€å˜åŒ–æ˜¯ Shiki ç°åœ¨ä¼š **åœ¨ä½¿ç”¨è®¡åˆ’åœ¨ v3 ä¸­ç§»é™¤çš„å¼ƒç”¨ API æ—¶å‘å‡ºè­¦å‘Š**ã€‚ç”±äºè¿™å¯èƒ½ä¼šå½±å“æœ€ç»ˆç”¨æˆ·ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸»è¦ç‰ˆæœ¬çš„æå‡ï¼Œè¿™æ ·ä½ å¯ä»¥é€‰æ‹©åŠ å…¥è­¦å‘Šå¹¶ä¸ºå°†æ¥çš„ç§»é™¤åšå¥½å‡†å¤‡ã€‚

- `v1.x`ï¼šå¼ƒç”¨çš„ API ä»ç„¶å—æ”¯æŒï¼Œåªåœ¨ç±»å‹çº§åˆ«ä¸Šæ ‡è®°ã€‚å¯ä»¥é€‰æ‹©æ€§åœ°å¯ç”¨è¿è¡Œæ—¶è­¦å‘Šã€‚
- ğŸ‘‰ `v2.0`ï¼šæ²¡æœ‰é‡å¤§å˜æ›´ï¼Œä½†é»˜è®¤å¯ç”¨è¿è¡Œæ—¶å¼ƒç”¨è­¦å‘Šã€‚
- `v3.0`ï¼šç§»é™¤å¼ƒç”¨çš„ APIï¼Œé‡å¤§å˜æ›´ã€‚

é¢„è®¡ v3.0.0 å°†åœ¨ v2.0.0 ä¹‹åä¸ä¹…å‘å¸ƒã€‚

## è‡ªåŠ¨è¿ç§»

ä¸ºäº†å¸®åŠ©è¿ç§»è¿‡ç¨‹ï¼Œç¤¾åŒºæˆå‘˜ [Covolute](https://covolute.com/registry/shiki/v1-to-v2) æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ä»£ç ä¿®æ”¹å·¥å…·ï¼Œå¤„ç†ä» v1 åˆ° v2 çš„å¤§éƒ¨åˆ† API æ›´æ”¹ã€‚æ‚¨å¯ä»¥ç›´æ¥è¿è¡Œå®ƒï¼š

```bash
npx covolute@latest shiki/v1-to-v2
```

## å¼ƒç”¨è¯´æ˜

æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å°½å¿«è¿ç§»å¼ƒç”¨çš„åŠŸèƒ½ï¼Œä»¥è­¦å‘Šæ¶ˆæ¯ä½œä¸ºæŒ‡å¯¼ã€‚

### `getHighlighter` -> `createHighlighter`

æ²¡æœ‰åŠŸèƒ½ä¸Šçš„å˜åŒ–ï¼Œæ›´åƒæ˜¯æ›´æ­£å‘½åä»¥é¿å…æ··æ·†ã€‚åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥æ‰¾å’Œæ›¿æ¢ã€‚

### WASM ç›¸å…³ API

è‡ªä» v1.16 ä¸­å¼•å…¥ [å¼•æ“ç³»ç»Ÿ](/guide/regex-engines) åï¼Œä¸ WebAssembly ç›¸å…³çš„ä¾èµ–ä¸å†æ˜¯ç¡¬æ€§è¦æ±‚ã€‚ä¸ºäº†ä¿ƒè¿›æ ‘æ‘‡å’Œå°†å¼•æ“ä¸æ ¸å¿ƒè§£è€¦ï¼Œæå–äº†ä¸¤ä¸ªåŒ…ï¼š`@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript`ã€‚è¿™ä¸¤ä¸ªåŒ…ä¹Ÿåˆ†åˆ«ä½œä¸º `shiki/engine/oniguruma` å’Œ `shiki/engine/javascript` ä»ä¸»åŒ…ä¸­é‡æ–°å¯¼å‡ºã€‚

æ‚¨å¯èƒ½éœ€è¦æ›´æ”¹å¯¼å…¥è·¯å¾„ï¼š

```ts
import { loadWasm } from 'shiki' // [!code --]
import { loadWasm } from 'shiki/engine/oniguruma' // [!code ++]
```

`createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢« `engine` å­—æ®µå–ä»£ï¼š

```ts
import { createHighlighter } from 'shiki'
import { createOnigurumaEngine } from 'shiki/engine/oniguruma' // [!code ++]

const shiki = await createHighlighter({
  // ...
  loadWasm: () => import('shiki/wasm'), // [!code --]
  engine: createOnigurumaEngine(() => import('shiki/wasm')), // [!code ++]
})
```

### Shiki å…¼å®¹æ€§

ä¸ºäº†ä¸ v0.14 å…¼å®¹è€Œæ„å»ºçš„ `@shikijs/compat` åŒ…ç°åœ¨å·²è¢«å¼ƒç”¨ã€‚è¯·è¿ç§»åˆ°ä¸»åŒ…ã€‚æ­¤åŒ…å°†åœ¨ v3.0 ä¸­è¢«ç§»é™¤ã€‚

### è½¬æ¢å™¨åŒ¹é…ç®—æ³•

åœ¨ v1.29.0 ä¸­å¼•å…¥äº†è½¬æ¢å™¨çš„ `matchAlgorithm` é€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©åŒ¹é…ç®—æ³•ã€‚é»˜è®¤å€¼å°†åœ¨ v3.0.0 ä¸­ä» `v1` æ›´æ”¹ä¸º `v3`ã€‚æˆ‘ä»¬å»ºè®®æ˜ç¡®è®¾ç½® `matchAlgorithm` é€‰é¡¹ï¼Œä»¥é¿å…æœªæ¥çš„é‡å¤§å˜æ›´ã€‚

[äº†è§£æ›´å¤š](/packages/transformers#matching-algorithm)ã€‚

### å…¶ä»–å¼ƒç”¨è¯´æ˜

- `createdBundledHighlighter` éœ€è¦ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡æ ·å¼å‚æ•°
- `@shikijs/core`
  - æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ `createJavaScriptRegexEngine` å’Œ `createOnigurumaEngine` ä¸å†åŒ…å«ï¼Œåˆ†åˆ«ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` å¯¼å…¥
  - `createHighlighterCore` ç°åœ¨æ˜ç¡®è¦æ±‚ä¼ å…¥ `engine` å­—æ®µ
  - `createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢« `engine` å­—æ®µå–ä»£
  - `@shikijs/core/wasm-inline` è¢« `@shikijs/engine-oniguruma/wasm-inline` å–ä»£
  - ä» `@shikijs/vscode-textmate` å¯¼å…¥ `FontStyle` å’Œ `StackElementMetadata` è€Œä¸æ˜¯ä» `@shikijs/core`

## è°ƒæ•´è­¦å‘Š

å¦‚æœæ‚¨æ›´å–œæ¬¢ç¡¬é”™è¯¯è€Œä¸æ˜¯è­¦å‘Šï¼Œåˆ™å¯ä»¥åœ¨ä½¿ç”¨ Shiki ä¹‹å‰è¿è¡Œä»¥ä¸‹ä»£ç ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å†³å®šæ˜¯å¦å¯ç”¨è­¦å‘Šï¼Œç¬¬äºŒä¸ªå‚æ•°å†³å®šæ˜¯å¦å°†è­¦å‘ŠæŠ›å‡ºä¸ºé”™è¯¯ï¼š

```ts
import { enableDeprecationWarnings } from 'shiki/core'

enableDeprecationWarnings(true, true) // å¯ç”¨è­¦å‘Šå¹¶æŠ›å‡ºé”™è¯¯

// ä¹‹åä½¿ç”¨ createHighlighter(...) ç­‰
```

### ç¦ç”¨è­¦å‘Š

å¦‚æœæ‚¨æƒ³ç¦ç”¨è­¦å‘Šï¼š

```ts
import { enableDeprecationWarnings } from 'shiki/core'

enableDeprecationWarnings(false)
```

## ä½œä¸ºç”¨æˆ·å°è¯•

å¦‚æœæ‚¨é€šè¿‡å…¶ä»–åŒ…é—´æ¥ä½¿ç”¨ Shikiï¼Œä¾‹å¦‚ [`vitepress`](https://vitepress.zhcndoc.com/) æˆ– [`@nuxt/content`](https://content.nuxt.com/)ï¼Œæ‚¨å¯ä»¥å°è¯•åœ¨æ‚¨çš„ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼Œä»¥å¼ºåˆ¶ä½¿ç”¨ Shiki v2.0.0ã€‚è¿™å°†å¸®åŠ©æ‚¨æ£€æŸ¥æ‚¨ä½¿ç”¨çš„æ¡†æ¶/å·¥å…·æ˜¯å¦ä¾èµ–äºè¢«å¼ƒç”¨çš„ Shiki APIã€‚å¦‚æœä»–ä»¬æœ‰ï¼Œè¯·å‘ä»–ä»¬çš„ä»“åº“æŠ¥å‘Šä»¥æé«˜å³å°†åˆ°æ¥çš„å˜æ›´çš„æ„è¯†ã€‚è°¢è°¢ï¼

```json
{
  "resolutions": {
    "shiki": "^2",
    "@shikijs/core": "^2",
    "@shikijs/transformers": "^2",
    "@shikijs/markdown-it": "^2",
    "@shikijs/rehype": "^2"
  }
}
```

## åé¦ˆ

ä»»ä½•åé¦ˆéƒ½æ¬¢è¿ï¼æ¬¢è¿åœ¨ [GitHub](https://github.com/shikijs/shiki) ä¸Šå¼€è®¾é—®é¢˜å¹¶å‘ŠçŸ¥æˆ‘ä»¬æ‚¨çš„æƒ³æ³•ã€‚
